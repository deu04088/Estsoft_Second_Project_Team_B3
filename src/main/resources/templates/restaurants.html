<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <title>우리 동네 식당 소개 | BizBeacon for Boss</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link th:href="@{/css/style.css}" rel="stylesheet" />
        <link th:href="@{/css/header.css}" rel="stylesheet" />
        <link th:href="@{/css/footer.css}" rel="stylesheet" />
        <!-- FontAwesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
        <!-- 내부 CSS -->
        <style>
            .banner {
                background-color: #d9f7f7;
                padding: 2rem;
                margin-bottom: 2rem;
                text-align: center;
            }
            .restaurant-card {
                border: 1px solid #dee2e6;
                border-radius: 6px;
                padding: 1rem;
                text-align: center;
                transition: box-shadow 0.2s ease;
            }
            .restaurant-card:hover {
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }
            .register-btn {
                position: fixed;
                bottom: 40px;
                right: 40px;
                border-radius: 50%;
                width: 80px;
                height: 80px;
                font-size: 16px;
            }
        </style>
    </head>
    <body>
        <!-- Header -->
        <div th:replace="partials/logined-header :: logined-header"></div>

        <!-- 배너 -->
        <section class="banner">
            <h2>우리 동네 식당 소개</h2>
            <p>오늘도 가장 앞서 뜨겁게 달립니다.</p>
        </section>
        <!--
    [우리 동네 식당 소개 페이지 흐름]

    1. 페이지 진입 시:
       - 로그인된 사용자의 userId를 기준으로 DB에서 address 조회
       - /api/restaurants?page=n API 호출 시 내부적으로 user.address를 사용하여 필터링
       - 해당 동네 식당 리스트를 조회해서 화면에 렌더링

    2. 검색:
       - 검색창에 메뉴명 입력 후 제출 → /search?menu=값 요청
       - 결과 페이지(restaurants-search.html)에서 동일한 카드 구조로 출력

    3. 카드 클릭:
       - 특정 식당 상세 페이지(/restaurant-detail/{id})로 이동

    4. 식당 등록 버튼:
       - /restaurant-form 페이지로 이동 (새 식당 등록)
-->

        <main class="container">

            <h3 class="text-center mb-4">우리 동네 식당 소개</h3>
            <!-- 식당이 없을 경우 안내 문구 -->
            <div th:if="${page.totalElements == 0}" class="text-center my-5">
                <p class="text-muted">근처 동네에 등록된 식당이 없습니다.</p>
            </div>
            <!-- 식당 리스트 -->
            <div class="row g-4">
                <!-- 반복 렌더링 예시 -->
                <div class="col-md-3" th:each="restaurant : ${restaurants}">
                    <a th:href="@{/restaurant-detail/{id}(id=${restaurant.id})}" class="text-decoration-none text-dark">
                        <div class="restaurant-card">
                            <!-- S3에 등록된 식당 사진 가져오기 -->
                            <img th:src="${restaurant.s3Url}"
                                 alt="식당 이미지"
                                 style="width: 100%; height: 100%; object-fit: cover;" />
                            </div>
                            <h5 th:text="${restaurant.name}">식당 이름</h5>
                            <p th:text="${restaurant.menuName}">대표 메뉴</p>
                            <p th:text="${#numbers.formatInteger(restaurant.price, 0)} + '원'">메뉴 가격</p>
                            <small>조회수 <span th:text="${restaurant.viewCount}">조회수</span></small>
                    </a>
                </div>
            </div>

            <!-- 페이지네이션 -->
            <div class="d-flex justify-content-center my-4" th:if="${page.totalElements > 0}">
                <nav>
                    <ul class="pagination">
                        <li th:classappend="${page.first} ? 'disabled'" class="page-item">
                            <a class="page-link"
                               th:href="@{${url}(menu=${menu}, page=${page.number - 1})}">&lt;</a>
                        </li>

                        <li th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
                            th:classappend="${i == page.number} ? 'active'" class="page-item">
                            <a class="page-link"
                               th:href="@{${url}(menu=${menu}, page=${i})}"
                               th:text="${i + 1}">1</a>
                        </li>

                        <li th:classappend="${page.last} ? 'disabled'" class="page-item">
                            <a class="page-link"
                               th:href="@{${url}(menu=${menu}, page=${page.number + 1})}">&gt;</a>
                        </li>
                    </ul>
                </nav>
            </div>

            <!-- 식당 등록 버튼 -->
            <a
                th:href="@{/restaurant-form}"
                class="btn btn-primary register-btn d-flex align-items-center justify-content-center"
            >
                식당 등록
            </a>
        </main>

        <!-- Footer -->
        <div th:replace="partials/footer :: footer"></div>

        <!-- 관리자 모달 include -->
        <div th:replace="~{partials/admin-modal :: admin-modal}"></div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script th:src="@{/js/admin-modal.js}"></script>
    </body>
</html>
