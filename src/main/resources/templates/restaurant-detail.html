<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì‹ë‹¹ ìƒì„¸ | BizBeacon for Boss</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <link th:href="@{/css/header.css}" rel="stylesheet" />
    <link th:href="@{/css/footer.css}" rel="stylesheet" />
    <!-- ë‚´ë¶€ CSS  -->
    <style>
        .detail-container {
            max-width: 800px;
            margin: 2rem auto;
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 8px;
        }

        .restaurant-img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .btn-action {
            min-width: 100px;
        }
    </style>
</head>
<body>

<!-- Header -->
<div th:replace="partials/logined-header :: logined-header"></div>

<main class="container">

<!--
    [ì‹ë‹¹ ìƒì„¸ í˜ì´ì§€ íë¦„]

    1. í˜ì´ì§€ ì§„ì… ì‹œ:
       - GET /api/restaurants/{id} API í˜¸ì¶œ â†’ Restaurant ë°ì´í„° ì¡°íšŒ
       - ì¡°íšŒìˆ˜ +1 ì—…ë°ì´íŠ¸ ì²˜ë¦¬(POST)

    2. ë²„íŠ¼ í‘œì‹œ ì¡°ê±´:
       - restaurant.userId == session.user.id â†’ ìˆ˜ì •í•˜ê¸°/ì‚­ì œí•˜ê¸° ë²„íŠ¼ í‘œì‹œ
       - restaurant.userId != session.user.id â†’ ì±„íŒ…í•˜ê¸° ë²„íŠ¼ í‘œì‹œ

    3. ì¢‹ì•„ìš”:
       - "ğŸ‘" ë²„íŠ¼ í´ë¦­ ì‹œ POST /api/restaurants/{id}/like
       - ì´ë¯¸ ì¢‹ì•„ìš” ëˆ„ë¥¸ ê²½ìš° â†’ DELETE /api/restaurants/{id}/like

    4. ìˆ˜ì •í•˜ê¸°:
       - /restaurant-form/{id} í˜ì´ì§€ë¡œ ì´ë™ (ê¸°ì¡´ ê°’ ë¶ˆëŸ¬ì˜¤ê¸°)

    5. ì‚­ì œí•˜ê¸°:
       - DELETE /api/restaurants/{id} API í˜¸ì¶œ
       - ì„±ê³µ ì‹œ â†’ /restaurants í˜ì´ì§€ë¡œ redirect

    6. ì±„íŒ…í•˜ê¸°:
       - POST /chats ìš”ì²­ (ìƒëŒ€ë°© userId ì „ë‹¬)
       - ì„±ê³µ ì‹œ â†’ /chat/{roomId} í˜ì´ì§€ë¡œ ì´ë™
    -->


    <div class="detail-container">
        <!-- ë’¤ë¡œê°€ê¸° -->
        <a th:href="@{/restaurants}" class="btn btn-link mb-3">&lt; ë’¤ë¡œê°€ê¸°</a>

        <!-- ëŒ€í‘œ ì´ë¯¸ì§€ -->
        <img th:src="${restaurant.getS3Url()}" alt="ì‹ë‹¹ ì´ë¯¸ì§€" class="restaurant-img">

        <!-- ìƒí˜¸ëª… -->
        <h3 th:text="${restaurant.getName()}">OK Burger</h3>

        <!-- ì¡°íšŒìˆ˜/ì¢‹ì•„ìš” -->
        <p>
            ì¡°íšŒìˆ˜ <span th:text="${restaurant.getViewCount()}">15</span> |
<!--            ì¢‹ì•„ìš” <span th:text="${testRestaurant.likeCount}">20</span>-->
<!--            <button class="btn btn-sm btn-outline-warning">ğŸ‘</button>-->
            ì¢‹ì•„ìš” <span id="like-count" th:text="${restaurant.getLikeCount()}">0</span>
            <button id="like-btn" class="btn btn-sm btn-outline-warning"
                    th:attr="data-restaurant-id=${restaurant.getId()}">ğŸ‘
            </button>

            <!-- íƒ€ì¸ ê°€ê²Œì¼ ê²½ìš° (ì±„íŒ…í•˜ê¸°) -->
            <div th:unless="${restaurant.getId() == sessionUser.id}">
                <a th:href="@{'/chat?partnerId=' + ${restaurant.getId()}}" class="btn btn-primary btn-action">ì±„íŒ…í•˜ê¸°</a>
            </div>
        </p>

        <!-- ëŒ€í‘œ ë©”ë‰´/ê°€ê²© -->
        <h5 th:text="${restaurant.getMenuName()}">ë°ë¦¬ì•¼ë¼ ë²„ê±°</h5>
        <p th:text="${restaurant.getDescription()}">ìŠ¤í…Œì´í¬ 200gê³¼ ì–‘ìƒì¶”, í† ë§ˆí† ë¡œ ë‹¹ì¼ ìƒì‚°í•©ë‹ˆë‹¤.</p>
        <p><strong th:text="${#numbers.formatInteger(restaurant.getPrice(),0)} + 'ì›'">11,000ì›</strong></p>
        <p>ì¥ì†Œ | <span th:text="${restaurant.getAddress()}">ê°•ì„œêµ¬ í™”ê³¡ë™</span></p>

        <!-- ë²„íŠ¼ ì˜ì—­ -->
        <div class="mt-4">
            <!-- ë³¸ì¸ ê°€ê²Œì¼ ê²½ìš° (ìˆ˜ì •/ì‚­ì œ) -->
            <div th:if="${restaurant.getId() == sessionUser.id}">
                <a th:href="@{'/update-form/' + ${restaurant.getId()}}" class="btn btn-secondary btn-action">ìˆ˜ì •í•˜ê¸°</a>
                <form th:action="@{|/api/restaurants/${restaurant.getId()}/delete|}" method="post" style="display:inline;">
                    <input type="hidden" name="_method" value="delete">
                    <button type="submit" class="btn btn-danger btn-action">ì‚­ì œí•˜ê¸°</button>
                </form>
            </div>
        </div>
    </div>
</main>

<script th:inline="javascript">
    const likeBtn = document.getElementById('like-btn');
    const likeCountSpan = document.getElementById('like-count');

    likeBtn.addEventListener('click', function() {
        const restaurantId = this.getAttribute('data-restaurant-id');

        fetch('/api/restaurants/' + restaurantId + '/like', {
            method: 'POST',
        })
            .then(response => response.json())
            .then(data => {
                likeCountSpan.textContent = data.likeCount; // ì„œë²„ì—ì„œ ìƒˆ ì¢‹ì•„ìš” ìˆ˜ ë°˜í™˜
            })
            .catch(err => console.error(err));
    });
</script>

<!-- Footer -->
<div th:replace="partials/footer :: footer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
